name: OAuth Token Test
 
on:
  push:
    paths:
      - main
 
jobs:
  extract:
    runs-on: ubuntu-latest
 
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
 
      - name: Get OAuth Token
        id: get_token
        env:
          OAUTH_URL: https://accenture-sbg-asg.authentication.eu10.hana.ondemand.com
          OAUTH_CLIENT_ID: ${{ secrets.OAUTH_CLIENT_ID }}
          OAUTH_CLIENT_SECRET: ${{ secrets.OAUTH_CLIENT_SECRET }}
        run: |
          set -euo pipefail
 
          echo "ðŸ”‘ Requesting OAuth2 token..."
 
          response=$(curl -sS -X POST "$OAUTH_URL/oauth/token" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "grant_type=client_credentials" \
            --data-urlencode "client_id=$OAUTH_CLIENT_ID" \
            --data-urlencode "client_secret=$OAUTH_CLIENT_SECRET")
 
          echo "ðŸ“¥ Raw response received"
 
          token=$(echo "$response" | jq -r '.access_token // empty')
 
          if [ -z "$token" ]; then
            echo "âŒ Failed to fetch access token"
            echo "Response was: $response"
            exit 1
          fi
 
          echo "âœ… Successfully retrieved access token"
          echo "token=$token" >> "$GITHUB_OUTPUT"
 
      - name: Use token example
        run: |
          echo "Token length: ${#TOKEN}"
        env:
          TOKEN: ${{ steps.get_token.outputs.token }}
